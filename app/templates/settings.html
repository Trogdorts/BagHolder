{% extends "base.html" %}
{% block content %}
{% set show_unrealized = cfg.ui.get('show_unrealized', True) %}
{% set show_trade_count = cfg.ui.get('show_trade_count', True) %}
{% set show_text = cfg.ui.get('show_text', True) %}
{% set show_weekends = cfg.ui.get('show_weekends', False) %}
{% set show_percentages = cfg.ui.get('show_percentages', True) %}
{% set default_view = cfg.view.get('default', 'latest') %}
{% set unrealized_fill = cfg.ui.get('unrealized_fill_strategy', 'carry_forward') %}
{% set export_fill_empty = cfg.export.get('fill_empty_with_zero', True) %}
{% set server_port = cfg.get('server', {}).get('port', 8012) %}
<div class="mx-auto flex w-full max-w-6xl flex-col gap-8 px-4 py-8 sm:px-6 lg:px-8">
  <header class="rounded-xl border border-neutral-800 bg-neutral-900/80 p-6 shadow-sm">
    <div class="flex flex-col gap-2">
      <div>
        <p class="text-xs font-semibold uppercase tracking-wide text-blue-300">BagHolder</p>
        <h1 class="text-2xl font-semibold text-neutral-50 sm:text-3xl">Settings</h1>
      </div>
      <p class="max-w-2xl text-sm text-neutral-400">Fine-tune how BagHolder looks, calculates totals, and manages data without scrolling through empty space.</p>
    </div>
  </header>

  <div class="space-y-3">
    {% if config_imported %}
      <div class="alert alert-success px-4 py-3 text-sm">Configuration imported successfully.</div>
    {% elif config_error_message %}
      <div class="alert alert-error px-4 py-3 text-sm">{{ config_error_message }}</div>
    {% endif %}
    {% if backup_restored %}
      <div class="alert alert-success px-4 py-3 text-sm">Backup imported successfully.</div>
    {% elif backup_error_message %}
      <div class="alert alert-error px-4 py-3 text-sm">{{ backup_error_message }}</div>
    {% endif %}
    {% if log_error_message %}
      <div class="alert alert-error px-4 py-3 text-sm">{{ log_error_message }}</div>
    {% endif %}
    {% if cleared %}
      <div class="alert alert-success px-4 py-3 text-sm">All application data has been cleared.</div>
    {% endif %}
    {% if shutting_down %}
      <div class="alert alert-warning px-4 py-3 text-sm">The server is shutting down. You may now close this window.</div>
    {% endif %}
  </div>

  <div class="grid gap-6 lg:grid-cols-[minmax(0,2.2fr)_minmax(0,1fr)] xl:gap-8">
    <form method="post" action="/settings" class="flex flex-col gap-6" x-data="settingsForm()" @submit="resetChanges()">
      <div x-show="hasChanges" x-cloak x-transition.opacity.duration.200ms class="rounded-lg border border-amber-500/60 bg-amber-500/10 px-4 py-3 text-sm text-amber-200">
        You have unsaved changes. Don't forget to save before leaving this page.
      </div>

      <section id="display-settings" class="rounded-xl border border-neutral-800 bg-neutral-900/80 p-6 shadow-sm">
        <header class="mb-4 flex flex-col gap-1">
          <h2 class="text-lg font-semibold text-neutral-50">Appearance &amp; calendar</h2>
          <p class="text-sm text-neutral-400">Configure the default look and feel of the calendar.</p>
        </header>
        <div class="grid gap-5">
          <div class="grid gap-3 sm:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)] sm:items-start">
            <div>
              <label for="theme" class="block text-sm font-medium text-neutral-200">Theme</label>
              <p class="mt-1 text-xs text-neutral-500">Switch between the dark and light presentation.</p>
            </div>
            <select id="theme" name="theme" class="w-full rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-2 text-sm text-neutral-100">
              <option value="dark" {% if cfg.ui.theme == 'dark' %}selected{% endif %}>Dark</option>
              <option value="light" {% if cfg.ui.theme == 'light' %}selected{% endif %}>Light</option>
            </select>
          </div>
          <div class="grid gap-3 sm:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)] sm:items-start">
            <div>
              <label for="show_text" class="block text-sm font-medium text-neutral-200">Daily profit and loss</label>
              <p class="mt-1 text-xs text-neutral-500">Choose whether calendar cells show the numeric values.</p>
            </div>
            <select id="show_text" name="show_text" class="w-full rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-2 text-sm text-neutral-100">
              <option value="true" {% if show_text %}selected{% endif %}>Show values</option>
              <option value="false" {% if not show_text %}selected{% endif %}>Hide values</option>
            </select>
          </div>
          <div class="grid gap-3 sm:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)] sm:items-start">
            <div>
              <label for="show_trade_count" class="block text-sm font-medium text-neutral-200">Trade count badges</label>
              <p class="mt-1 text-xs text-neutral-500">Show how many trades occurred each day.</p>
            </div>
            <select id="show_trade_count" name="show_trade_count" class="w-full rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-2 text-sm text-neutral-100">
              <option value="true" {% if show_trade_count %}selected{% endif %}>Show badges</option>
              <option value="false" {% if not show_trade_count %}selected{% endif %}>Hide badges</option>
            </select>
          </div>
          <div class="grid gap-3 sm:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)] sm:items-start">
            <div>
              <label for="show_percentages" class="block text-sm font-medium text-neutral-200">Percentage change</label>
              <p class="mt-1 text-xs text-neutral-500">Display percent change badges alongside totals.</p>
            </div>
            <select id="show_percentages" name="show_percentages" class="w-full rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-2 text-sm text-neutral-100">
              <option value="true" {% if show_percentages %}selected{% endif %}>Show percentages</option>
              <option value="false" {% if not show_percentages %}selected{% endif %}>Hide percentages</option>
            </select>
          </div>
          <div class="grid gap-3 sm:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)] sm:items-start">
            <div>
              <p class="block text-sm font-medium text-neutral-200">Unrealized values</p>
              <p class="mt-1 text-xs text-neutral-500" x-show="!showUnrealizedSetting" x-cloak>
                Unrealized gains and losses remain hidden until toggled from the calendar toolbar.
              </p>
            </div>
            <div>
              <input type="hidden" name="show_unrealized" value="{{ 'true' if show_unrealized else 'false' }}" :value="showUnrealizedSetting ? 'true' : 'false'">
              <button type="button" class="w-full rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-2 text-sm font-medium text-neutral-100 transition"
                      :class="{ 'bg-neutral-800 text-neutral-50 border-neutral-600': !showUnrealizedSetting }"
                      @click="showUnrealizedSetting = !showUnrealizedSetting"
                      aria-pressed="{{ 'true' if show_unrealized else 'false' }}"
                      :aria-pressed="showUnrealizedSetting.toString()">
                <span x-text="showUnrealizedSetting ? 'Hide by default' : 'Show by default'">
                  {% if show_unrealized %}Hide by default{% else %}Show by default{% endif %}
                </span>
              </button>
            </div>
          </div>
          <div class="grid gap-3 sm:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)] sm:items-start">
            <div>
              <label for="show_weekends" class="block text-sm font-medium text-neutral-200">Display weekends</label>
              <p class="mt-1 text-xs text-neutral-500">Choose whether Saturday and Sunday appear in the grid.</p>
            </div>
            <select id="show_weekends" name="show_weekends" class="w-full rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-2 text-sm text-neutral-100">
              <option value="false" {% if not show_weekends %}selected{% endif %}>Hide weekends</option>
              <option value="true" {% if show_weekends %}selected{% endif %}>Show weekends</option>
            </select>
          </div>
          <div class="grid gap-3 sm:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)] sm:items-start">
            <div>
              <label for="default_view" class="block text-sm font-medium text-neutral-200">Default month view</label>
              <p class="mt-1 text-xs text-neutral-500">Decide where the calendar opens when you sign in.</p>
            </div>
            <select id="default_view" name="default_view" class="w-full rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-2 text-sm text-neutral-100">
              <option value="latest" {% if default_view == 'latest' %}selected{% endif %}>Jump to latest month</option>
              <option value="last_viewed" {% if default_view == 'last_viewed' %}selected{% endif %}>Remember last viewed</option>
            </select>
          </div>
        </div>
      </section>

      <section id="calculation-settings" class="rounded-xl border border-neutral-800 bg-neutral-900/80 p-6 shadow-sm">
        <header class="mb-4 flex flex-col gap-1">
          <h2 class="text-lg font-semibold text-neutral-50">Data handling</h2>
          <p class="text-sm text-neutral-400">Decide how missing values are calculated and exported.</p>
        </header>
        <div class="grid gap-5">
          <div class="grid gap-3 sm:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)] sm:items-start">
            <div>
              <label for="unrealized_fill_strategy" class="block text-sm font-medium text-neutral-200">Missing unrealized values</label>
              <p class="mt-1 text-xs text-neutral-500">Determines how empty calendar days are filled when no unrealized value was imported.</p>
            </div>
            <select id="unrealized_fill_strategy" name="unrealized_fill_strategy" class="w-full rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-2 text-sm text-neutral-100">
              <option value="carry_forward" {% if unrealized_fill == 'carry_forward' %}selected{% endif %}>Carry forward last known</option>
              <option value="average_neighbors" {% if unrealized_fill == 'average_neighbors' %}selected{% endif %}>Average nearest values</option>
            </select>
          </div>
          <div class="grid gap-3 sm:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)] sm:items-start">
            <div>
              <label for="export_empty_values" class="block text-sm font-medium text-neutral-200">Empty values in exports</label>
              <p class="mt-1 text-xs text-neutral-500">Control whether missing values export as zeros or blank cells.</p>
            </div>
            <select id="export_empty_values" name="export_empty_values" class="w-full rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-2 text-sm text-neutral-100">
              <option value="zero" {% if export_fill_empty %}selected{% endif %}>Fill with 0</option>
              <option value="empty" {% if not export_fill_empty %}selected{% endif %}>Leave empty</option>
            </select>
          </div>
        </div>
      </section>

      <section id="server-settings" class="rounded-xl border border-neutral-800 bg-neutral-900/80 p-6 shadow-sm">
        <header class="mb-4 flex flex-col gap-1">
          <h2 class="text-lg font-semibold text-neutral-50">Server access</h2>
          <p class="text-sm text-neutral-400">Adjust how the app listens for connections.</p>
        </header>
        <div class="grid gap-5">
          <div class="grid gap-3 sm:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)] sm:items-start">
            <div>
              <label for="listening_port" class="block text-sm font-medium text-neutral-200">Listening port</label>
              <p class="mt-1 text-xs text-neutral-500">Choose the network port BagHolder binds to. A restart may be required for changes to take effect.</p>
            </div>
            <div class="flex flex-col gap-2">
              <input type="number" id="listening_port" name="listening_port" min="1" max="65535" value="{{ server_port }}" class="w-full rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-2 text-sm text-neutral-100">
              <p class="text-[11px] uppercase tracking-wide text-neutral-600">Range: 1â€“65535</p>
            </div>
          </div>
        </div>
      </section>

      <section id="palette-settings" class="rounded-xl border border-neutral-800 bg-neutral-900/80 p-6 shadow-sm">
        <div class="mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
          <div>
            <h2 class="text-lg font-semibold text-neutral-50">Color palette</h2>
            <p class="mt-1 text-sm text-neutral-400">Adjust the interface accents used across the calendar, actions, and notes.</p>
          </div>
          <button type="button" class="btn btn-outline-primary px-3 py-2 text-sm"
                  @click="resetAllColors()"
                  :class="{ 'opacity-50 cursor-not-allowed pointer-events-none': colorsAreDefault() }"
                  :aria-disabled="colorsAreDefault().toString()"
                  :disabled="colorsAreDefault()">
            Reset palette
          </button>
        </div>
        <div class="grid gap-4">
          {% for group in color_groups | default([], true) %}
          <div class="rounded-lg border border-neutral-800/80 bg-neutral-950/40 p-4">
            <div class="mb-4 space-y-1">
              <h3 class="text-sm font-semibold text-neutral-100">{{ group.title }}</h3>
              <p class="text-xs text-neutral-500 leading-relaxed">{{ group.description }}</p>
            </div>
            <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
              {% for field in group.fields %}
              <label class="flex flex-col gap-2">
                <div class="flex items-center justify-between gap-2">
                  <span class="text-sm font-medium text-neutral-200">{{ field.label }}</span>
                  <button type="button" class="text-xs text-neutral-400 transition hover:text-neutral-100"
                          @click.prevent="resetColor('{{ field.name }}')"
                          :class="{ 'opacity-40 pointer-events-none': isColorDefault('{{ field.name }}') }"
                          :aria-disabled="isColorDefault('{{ field.name }}').toString()">
                    Reset
                  </button>
                </div>
                <input type="color" name="{{ field.name }}" value="{{ field.current }}" class="h-10 w-full cursor-pointer rounded border border-neutral-700 bg-transparent p-1">
                <p class="text-xs text-neutral-500 leading-snug">
                  {{ field.description }}
                  <span class="ml-1 uppercase tracking-wide text-[11px]">Default: {{ field.default | upper }}</span>
                </p>
              </label>
              {% endfor %}
            </div>
          </div>
          {% endfor %}
        </div>
      </section>

      <section id="diagnostic-settings" class="rounded-xl border border-neutral-800 bg-neutral-900/80 p-6 shadow-sm">
        <header class="mb-4 flex flex-col gap-1">
          <h2 class="text-lg font-semibold text-neutral-50">Diagnostics</h2>
          <p class="text-sm text-neutral-400">Persist detailed logs for troubleshooting and share them with support.</p>
        </header>
        <div class="grid gap-5">
          <div class="grid gap-3 sm:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)] sm:items-start">
            <div>
              <label for="debug_logging" class="block text-sm font-medium text-neutral-200">Debug logging</label>
              <p class="mt-1 text-xs text-neutral-500">When enabled, verbose diagnostic entries are stored in the persistent log file.</p>
            </div>
            <select id="debug_logging" name="debug_logging" class="w-full rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-2 text-sm text-neutral-100">
              <option value="true" {% if debug_logging_enabled %}selected{% endif %}>Enabled</option>
              <option value="false" {% if not debug_logging_enabled %}selected{% endif %}>Disabled</option>
            </select>
          </div>
          <div class="grid gap-3 sm:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)] sm:items-start">
            <div>
              <p class="block text-sm font-medium text-neutral-200">Export debug log</p>
              <p class="mt-1 text-xs text-neutral-500">
                {% if log_export_available %}
                  Download the latest log for sharing with support.
                {% else %}
                  A log file appears here once the app records diagnostic events.
                {% endif %}
              </p>
            </div>
            <a href="/settings/logs/export" class="btn btn-outline-primary w-full px-4 py-2 text-sm {% if not log_export_available %}opacity-60 cursor-not-allowed pointer-events-none{% endif %}"
               {% if not log_export_available %}aria-disabled="true" tabindex="-1"{% endif %}>
              Download log
            </a>
          </div>
        </div>
      </section>

      <div class="flex flex-col items-stretch justify-between gap-3 rounded-xl border border-neutral-800 bg-neutral-900/80 p-5 shadow-sm sm:flex-row sm:items-center">
        <p class="text-xs text-neutral-500" x-show="!hasChanges" x-cloak>All changes are synced with the current configuration.</p>
        <button type="submit" class="btn btn-primary w-full px-5 py-2.5 sm:w-auto"
                :class="{ 'opacity-60 cursor-not-allowed': !hasChanges }"
                :disabled="!hasChanges">
          Save changes
        </button>
      </div>
    </form>

    <aside class="flex flex-col gap-6">
      <section id="stock-data-import" class="rounded-xl border border-neutral-800 bg-neutral-900/80 p-6 shadow-sm">
        <header class="mb-4">
          <h2 class="text-lg font-semibold text-neutral-50">Import trade history</h2>
          <p class="mt-1 text-sm text-neutral-400">Upload CSV trade summaries or ThinkOrSwim statements.</p>
        </header>
        <div class="space-y-5">
          <div class="rounded-lg border border-neutral-800/80 bg-neutral-950/40 p-4">
            <h3 class="text-sm font-semibold text-neutral-100">Stock buy &amp; sell CSV data</h3>
            <p class="mt-1 text-xs text-neutral-500">Import executed trades from a CSV with the columns date, symbol, action, qty, price, amount.</p>
            {% if trade_csv_error_message %}
            <div class="mt-3 rounded border border-red-500/60 bg-red-500/10 px-3 py-2 text-xs text-red-200">{{ trade_csv_error_message }}</div>
            {% endif %}
            <form action="/import/trades" method="post" enctype="multipart/form-data" class="mt-4 flex flex-col gap-3">
              <input type="file" name="file" accept=".csv" class="block w-full rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-2 text-sm text-neutral-100 file:mr-4 file:rounded-md file:border-0 file:bg-neutral-800 file:px-4 file:py-2 file:text-neutral-200 hover:file:bg-neutral-700">
              <button class="btn btn-primary px-4 py-2">Upload</button>
            </form>
          </div>
          <div class="rounded-lg border border-neutral-800/80 bg-neutral-950/40 p-4">
            <h3 class="text-sm font-semibold text-neutral-100">ThinkOrSwim account statement</h3>
            <p class="mt-1 text-xs text-neutral-500">Only trade fields are persisted (date, symbol, action, qty, price, amount). Account identifiers are discarded after parsing.</p>
            {% if thinkorswim_error_message %}
            <div class="mt-3 rounded border border-red-500/60 bg-red-500/10 px-3 py-2 text-xs text-red-200">{{ thinkorswim_error_message }}</div>
            {% endif %}
            <form action="/import/thinkorswim" method="post" enctype="multipart/form-data" class="mt-4 flex flex-col gap-3">
              <input type="file" name="file" accept=".csv" class="block w-full rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-2 text-sm text-neutral-100 file:mr-4 file:rounded-md file:border-0 file:bg-neutral-800 file:px-4 file:py-2 file:text-neutral-200 hover:file:bg-neutral-700">
              <button class="btn btn-primary px-4 py-2">Upload</button>
            </form>
          </div>
        </div>
      </section>

      <section id="configuration-settings" class="rounded-xl border border-neutral-800 bg-neutral-900/80 p-6 shadow-sm">
        <header class="mb-4">
          <h2 class="text-lg font-semibold text-neutral-50">Configuration</h2>
          <p class="mt-1 text-sm text-neutral-400">Export the current configuration or apply a previously exported JSON file.</p>
        </header>
        <div class="flex flex-col gap-4">
          <a href="/settings/config/export" class="btn btn-primary px-4 py-2 text-center" download>
            Download config (JSON)
          </a>
          <form method="post" action="/settings/config/import" class="flex flex-col gap-3" enctype="multipart/form-data">
            <label class="flex flex-col gap-2 text-sm font-medium text-neutral-200">
              Import configuration file
              <input type="file" name="config_file" accept=".json,application/json" class="w-full rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-2 text-sm text-neutral-100" required>
            </label>
            <p class="text-xs text-neutral-500">Upload a JSON file exported from BagHolder. Missing values revert to their defaults.</p>
            <button type="submit" class="btn btn-primary w-full px-4 py-2">Import config</button>
          </form>
        </div>
      </section>

      <section id="backup-settings" class="rounded-xl border border-neutral-800 bg-neutral-900/80 p-6 shadow-sm">
        <header class="mb-4">
          <h2 class="text-lg font-semibold text-neutral-50">Full backup</h2>
          <p class="mt-1 text-sm text-neutral-400">Create or restore a ZIP archive containing all application data.</p>
        </header>
        <div class="flex flex-col gap-4">
          <a href="/settings/backup/export" class="btn btn-primary px-4 py-2 text-center" download>
            Download full backup (ZIP)
          </a>
          <form method="post" action="/settings/backup/import" class="flex flex-col gap-3" enctype="multipart/form-data">
            <label class="flex flex-col gap-2 text-sm font-medium text-neutral-200">
              Import backup archive
              <input type="file" name="backup_file" accept=".zip" class="w-full rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-2 text-sm text-neutral-100" required>
            </label>
            <p class="text-xs text-neutral-500">Upload a ZIP file generated by BagHolder. Existing data will be replaced.</p>
            <button class="btn btn-primary w-full px-4 py-2">Import backup</button>
          </form>
        </div>
      </section>

      <section id="danger-zone" class="rounded-xl border border-red-900/60 bg-red-950/40 p-6 shadow-sm">
        <header class="mb-4">
          <h2 class="text-lg font-semibold text-red-200">Danger zone</h2>
          <p class="mt-1 text-sm text-red-200/80">Clearing data removes every imported trade, calculated summary, and saved note. This action cannot be undone.</p>
        </header>
        <form method="post" action="/settings/clear-data" onsubmit="return confirm('This will delete all trades, summaries, and notes. Continue?');" class="flex flex-col gap-3">
          <button class="btn btn-danger w-full px-4 py-2">Clear all data</button>
        </form>
        <form method="post" action="/settings/shutdown" onsubmit="return confirm('This will stop the server. Continue?');" class="mt-2 flex flex-col gap-3">
          <button class="btn btn-outline-danger w-full px-4 py-2">Shut down server</button>
        </form>
        <a href="https://buymeacoffee.com/crissejdav6" target="_blank" rel="noopener noreferrer"
           class="btn btn-outline-danger mt-3 inline-flex w-full justify-center px-3 py-1 text-xs uppercase tracking-wide">
          Buy me a coffee
        </a>
      </section>
    </aside>
  </div>
</div>
<script>
  document.addEventListener('alpine:init', () => {
    Alpine.data('settingsForm', () => ({
      showUnrealizedSetting: {{ 'true' if show_unrealized else 'false' }},
      hasChanges: false,
      initialData: '',
      formEl: null,
      defaultColors: {{ color_defaults | default({}, true) | tojson | safe }},
      init() {
        this.formEl = this.$el;
        this.initialData = this.serializeForm();
        this.$watch('showUnrealizedSetting', () => this.evaluateChanges());
        this.formEl.addEventListener('input', () => this.evaluateChanges());
        this.formEl.addEventListener('change', () => this.evaluateChanges());
      },
      serializeForm() {
        if (!this.formEl) {
          return '';
        }
        const formData = new FormData(this.formEl);
        formData.set('show_unrealized', this.showUnrealizedSetting ? 'true' : 'false');
        return new URLSearchParams(formData).toString();
      },
      evaluateChanges() {
        this.hasChanges = this.serializeForm() !== this.initialData;
      },
      resetChanges() {
        this.initialData = this.serializeForm();
        this.hasChanges = false;
      },
      isColorDefault(field) {
        const defaultValue = this.defaultColors[field];
        if (!this.formEl || typeof defaultValue !== 'string') {
          return false;
        }
        const input = this.formEl.querySelector(`[name='${field}']`);
        if (!input) {
          return false;
        }
        return input.value.toLowerCase() === defaultValue.toLowerCase();
      },
      resetColor(field) {
        const defaultValue = this.defaultColors[field];
        if (typeof defaultValue !== 'string' || !this.formEl) {
          return;
        }
        const input = this.formEl.querySelector(`[name='${field}']`);
        if (!input) {
          return;
        }
        input.value = defaultValue.toLowerCase();
        input.dispatchEvent(new Event('input', { bubbles: true }));
        input.dispatchEvent(new Event('change', { bubbles: true }));
        this.evaluateChanges();
      },
      resetAllColors() {
        if (!this.formEl) {
          return;
        }
        Object.keys(this.defaultColors).forEach((field) => {
          this.resetColor(field);
        });
      },
      colorsAreDefault() {
        if (!this.formEl) {
          return false;
        }
        return Object.keys(this.defaultColors).every((field) => this.isColorDefault(field));
      }
    }));
  });
</script>
{% endblock %}
